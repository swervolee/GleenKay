<!DOCTYPE html>
{% load widget_tweaks %}

{% load static %}
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Tutor's Dashboard</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
		<script src="https://kit.fontawesome.com/11f4cefc5f.js" crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
		<link rel="stylesheet" href="https://cdn.rawgit.com/michalsnik/aos/2.1.1/dist/aos.css">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-beta2/css/bootstrap.min.css">
		<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<link rel="stylesheet" href="{% static 'styles/tutor_home.css'%}">
		<script src="{% static 'scripts/tutor_home.js' %}"></script>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<!-- Sidebar (visible by default with 'show' class) -->
				<nav id="sidebar" class="col-md-3 col-lg-2 text-dark vh-100 collapse show d-lg-flex flex-column justify-content-between">
					<ul class="nav flex-column mt-3 rounded">
						<li class="nav-item rounded">
							<a class="nav-link active text-dark" href="#">
								<i class="bi bi-house-fill text-dark"></i> Dashboard
							</a>
						</li>
						<li class="nav-item rounded">
							<a class="nav-link text-dark" href="#">
								<i class="bi bi-calendar-check-fill text-dark"></i> Planning
							</a>
						</li>
						<li class="nav-item rounded">
							<a class="nav-link text-dark" href="#">
								<i class="bi bi-briefcase-fill text-dark"></i> Work Dashboard
							</a>
						</li>
						<li class="nav-item rounded">
							<a class="nav-link text-dark" href="#">
								<i class="bi bi-cash-stack text-dark"></i> Paychecks
							</a>
						</li>
					</ul>
					<div class="d-flex justify-content-end mt-auto" style="padding: 1rem;">
						<a href="{% url 'Authentication:logout_user' %}" class="btn btn-light d-flex align-items-center text-danger mx-2" style="transition: background-color 0.3s; padding: 8px 12px;">
							<i class="bi bi-box-arrow-right me-2"></i> Logout
						</a>
					</div>
				</nav>
				
				<!-- Header for large screens -->
				<header class="col-md-9 col-lg-10 animate__animated animate__fadeInDown sticky-header rounded">
					<nav class="navbar navbar-expand-lg navbar-dark bg-gradient shadow-lg py-3 rounded">
						<a class="navbar-brand text-center font-weight-bold d-none d-lg-block text-light" href="#" style="font-size: 2rem; letter-spacing: 2px;">
							<i class="bi bi-book-fill me-2"></i> GLEENKAY ACADEMY
						</a>
					</nav>
				</header>


				<!-- Header for small devices -->
				<nav class="navbar navbar-expand-lg navbar-dark d-lg-none d-sm-none rounded p-1" style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000;">
					<div class="container-fluid">
						<a class="navbar-brand text-left" href="#">GLEENKAY ACADEMY</a>
						<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mobileNavbar" aria-controls="mobileNavbar" aria-expanded="false" aria-label="Toggle navigation">
							<span class="navbar-toggler-icon"></span>
						</button>
						<div class="collapse navbar-collapse" id="mobileNavbar">
							<!-- X button for closing the menu -->
							<button class="btn btn-close text-white float-end mb-2" id="closeMenu" aria-label="Close" style="font-size: 1.2rem; background: black">&times;</button>
							<div class="w-75 mx-auto">
								<ul class="navbar-nav">
									<li class="nav-item">
										<a class="nav-link" href="#">
											<i class="bi bi-house-fill"></i> Dashboard
										</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" href="#">
											<i class="bi bi-calendar-check-fill"></i> Planning
										</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" href="#">
											<i class="bi bi-briefcase-fill"></i> Work Dashboard
										</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" href="#">
											<i class="bi bi-cash-stack"></i> Paychecks
										</a>
									</li>
									<li class="nav-item">
										<a href="{% url 'Authentication:logout_user' %}" class="nav-link">
											<i class="bi bi-box-arrow-right"></i> Logout
										</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</nav>



				<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
					<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
						<h1 class="h2">Welcome, Tutor</h1>
					</div>


					<!-- Dashboard Section -->
					<section class="container-fluid dashboard">
						<div class="row justify-content-start">

							<!-- Upcoming Lessons Card -->
							<!-- Upcoming Lessons Card -->
							<div class="col-md-6 col-lg-4 mb-4">
								<div class="card shadow-lg">
									<div class="card-header bg-info text-light text-center">
										<h4 class="mb-0">Upcoming Lessons</h4>
									</div>
									<div class="card-body">
										<ul class="list-group">
											{% if tutor_jobs%}
											{% for bks in tutor_jobs|slice:":3" %}
											<li class="list-group-item d-flex justify-content-between align-items-center">
												<span>{{ bks.topic }} ({{ bks.user.first_name }} {{ bks.user.last_name }}) <br><small>{{ bks.date }} - {{ bks.time }}</small></span>
												<i class="bi bi-calendar-event text-primary"></i>
											</li>
											{% endfor %}
											{% else %}
											<p>Oops, no jobs selected. Check in the work dashboard for jobs</p>
											{% endif %}
										</ul>

										{% if booking|length > 3 %}
										<button class="btn btn-outline-info w-100 mt-3" data-bs-toggle="modal" data-bs-target="#viewAllLessonsModal">
											<i class="bi bi-eye"></i> View All Lessons
										</button>
										{% endif %}
									</div>
								</div>
							</div>

							<!-- Modal for Viewing All Lessons -->
							<div class="modal fade" id="viewAllLessonsModal" tabindex="-1" aria-labelledby="viewAllLessonsLabel" aria-hidden="true">
								<div class="modal-dialog modal-lg">
									<div class="modal-content">
										<div class="modal-header bg-info text-light">
											<h5 class="modal-title" id="viewAllLessonsLabel">All Lessons</h5>
											<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
										</div>
										<div class="modal-body" style="max-height: 400px; overflow-y: auto;">
											<ul class="list-group">
												{% for bks in booking %}
												<li class="list-group-item d-flex justify-content-between align-items-center">
													<span>{{ bks.topic }} ({{ bks.user.first_name }} {{ bks.user.last_name }}) <br><small>{{ bks.date }} - {{ bks.time }}</small></span>
													<i class="bi bi-calendar-event text-primary"></i>
												</li>
												{% endfor %}
											</ul>
										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
										</div>
									</div>
								</div>
							</div>

							<!-- Feedback Card -->
							<div class="col-md-6 col-lg-4 mb-4">
								<div class="card shadow-lg">
									<div class="card-header bg-success text-light text-center">
										<h4 class="mb-0">Recent Feedback</h4>
									</div>
									<div class="card-body">
										<ul class="list-group">
											<li class="list-group-item">
												<span><strong>John Doe:</strong> Great progress on algebra!</span>
											</li>
											<li class="list-group-item">
												<span><strong>Jane Smith:</strong> Needs to work on fractions.</span>
											</li>
											<li class="list-group-item">
												<span><strong>Michael Johnson:</strong> Excellent understanding of geometry.</span>
											</li>
										</ul>
										<button class="btn btn-outline-success w-100 mt-3">
											<i class="bi bi-file-earmark-text"></i> View All Feedback
										</button>
									</div>
								</div>
							</div>

							<!-- Student Profiles Card -->
							<div class="col-md-6 col-lg-4 mb-4">
								<div class="card shadow-lg">
									<div class="card-header bg-warning text-light text-center">
										<h4 class="mb-0">Student Profiles</h4>
									</div>
									<div class="card-body">
										<ul class="list-group">
											<li class="list-group-item">
												<a href="#" class="text-dark"><i class="bi bi-person-circle"></i> John Doe</a>
											</li>
											<li class="list-group-item">
												<a href="#" class="text-dark"><i class="bi bi-person-circle"></i> Jane Smith</a>
											</li>
											<li class="list-group-item">
												<a href="#" class="text-dark"><i class="bi bi-person-circle"></i> Michael Johnson</a>
											</li>
										</ul>
										<button class="btn btn-outline-warning w-100 mt-3">
											<i class="bi bi-people"></i> View All Profiles
										</button>
									</div>
								</div>
							</div>

							<!-- Lesson Statistics Card -->
							<div class="col-md-6 col-lg-4 mb-5">
								<div class="card shadow-lg">
									<div class="card-header bg-danger text-light text-center">
										<h4 class="mb-0">Lesson Statistics</h4>
									</div>
									<div class="card-body">
										<ul class="list-group">
											<li class="list-group-item d-flex justify-content-between align-items-center">
												Completed Lessons <span class="badge bg-danger">35</span>
											</li>
											<li class="list-group-item d-flex justify-content-between align-items-center">
												Upcoming Lessons <span class="badge bg-danger">5</span>
											</li>
										</ul>
									</div>
								</div>
							</div>

						</div>
					</section>





					<section class="container-fluid mt-5 work-dashboard mb-5">
						<div class="row justify-content-center">
							<div class="col-lg-12">
								<div class="card shadow-lg">
									<div class="card-header bg-dark text-light text-center">
										<h4 class="mb-0">Available Booked Lessons</h4>
									</div>
									<div class="card-body">
										<!-- Optional Filters (Subject, Date) -->
										<div class="row mb-3">
											<div class="col-md-6">
												<div class="input-group">
													<div class="input-group-prepend">
														<label class="input-group-text bg-dark text-light" for="subjectFilter">Filter by Subject</label>
													</div>
													<select class="custom-select" id="subjectFilter">
														<option selected>All Subjects</option>
														<option value="Math">Math</option>
														<option value="Geometry">Geometry</option>
														<option value="Algebra">Algebra</option>
													</select>
												</div>
											</div>
											<div class="col-md-6">
												<div class="input-group">
													<div class="input-group-prepend">
														<label class="input-group-text bg-dark text-light" for="dateFilter">Filter by Date</label>
													</div>
													<input type="date" id="dateFilter" class="form-control">
												</div>
											</div>
										</div>

										<!-- List of Available Lessons -->
										<ul class="list-group mb-3">

											{% if bookings %}
											{% for bks in booking %}
											{% if bks.isApproved == False %}
											<li class="list-group-item d-flex justify-content-between align-items-center">
												<div>
													<i class="bi bi-book-half text-danger me-2"></i>
													<strong>{{ bks.topic }}</strong> with <strong>{{ bks.user.first_name }}</strong>
													<span class="text-muted">on {{ bks.date }}, {{ bks.time }}</span>
												</div>
												<button class="btn btn-success" 
																onclick="openPickLessonModal('{{ bks.user.first_name }} {{ bks.user.last_name }}', 
																'{{ bks.topic }}', 
																'{{ bks.date }}', 
																'{{ bks.time }}', 
																'{{ bks.id }}')">
													Pick Lesson
												</button>
											</li>
											{% endif %}
											{% endfor %}
											{% else %}
											<p> Oops, Looks like there are no jobs for you </p>
											{% endif %}
										</ul>

										<!-- Load More Button -->
										<button class="btn btn-outline-dark w-100" id="loadMoreLessons">
											<i class="bi bi-plus-circle me-2"></i> View More Lessons
										</button>
									</div>
								</div>
							</div>
						</div>

						<!-- Modal for Picking a Lesson -->
						<div class="modal fade" id="pickLessonModal" tabindex="-1" aria-labelledby="pickLessonModalLabel" aria-hidden="true">
							<div class="modal-dialog modal-dialog-centered">
								<div class="modal-content shadow-lg rounded">
									<div class="modal-header bg-dark text-light">
										<h5 class="modal-title" id="pickLessonModalLabel">
											<i class="bi bi-calendar-check-fill me-2"></i> Confirm Lesson Pick
										</h5>
										<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>
									<div class="modal-body">
										<div class="p-3 mb-3 bg-light rounded border shadow-sm">
											<h6 class="mb-2"><i class="bi bi-person-fill me-2 text-primary"></i> <strong>Student Name:</strong></h6>
											<p class="fs-5" id="modalStudentName"></p>
											
											<h6 class="mb-2">
												<i class="bi bi-person-fill me-2 text-primary"></i> 
												<strong>Student ID:</strong>
												<p id="modalStudentId"></p>	
											</h6>

											<h6 class="mb-2"><i class="bi bi-book-half me-2 text-success"></i> <strong>Subject:</strong></h6>
											<p class="fs-5" id="modalSubject"></p>

											<h6 class="mb-2"><i class="bi bi-clock-fill me-2 text-info"></i> <strong>Date & Time:</strong></h6>
											<p class="fs-5" id="modalDateTime"></p>

											<h6 class="mb-2"><i class="bi bi-brain-fill me-2 text-warning"></i> <strong>Learning Area:</strong></h6>
											<p class="fs-5 mb-3" id="modalLearningArea"></p>

											<!-- Google Meet Link Input -->
											<form class='mt-3' id="bookLessonForm" action="addMeetLink/" method="POST">
												<!-- Google Meet Link Input -->
												<div class="mb-3">
													<input type="url" id="googleMeetLink" name="google_meet_link" class="form-control" placeholder="https://meet.google.com/xxxx-xxxx-xx" required>
													<small class="text-muted">Please provide a valid Google Meet link</small>
												</div>

												<!-- Modal Footer with Buttons -->
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
														<i class="bi bi-x-circle me-2"></i> Cancel
													</button>
													<button type="submit" class="btn btn-success" id="confirmPickLesson">
														<i class="bi bi-check-circle me-2"></i> Confirm
													</button>
												</div>
											</form>
											<!---------------------------------------------------------------------------->
											<div id="notification" class="alert alert-success" style="display: none; position: fixed; top: 20px; right: 20px; z-index: 1000;">
												Lesson booked successfully!
											</div>



									</div>
								</div>
							</div>
						</div>

						<script>
							// Function to open the modal and populate it with lesson details
							function openPickLessonModal(studentName, subject, date, time, id) {
								$('#modalStudentName').text(studentName);
								$('#modalSubject').text(subject);
								$('#modalDateTime').text(`${date}, ${time}`);
								$('#modalLearningArea').text(subject);
								$('#modalStudentId').text(id);
								$('#pickLessonModal').modal('show');
							}

							// Validate Google Meet link
							function validateMeetLink(link) {
								const meetLinkPattern = /^https:\/\/meet\.google\.com\/[a-z0-9\-]+$/;
								return meetLinkPattern.test(link);
							}

							// Event handler for confirming the lesson pick
							$('#bookLessonForm').on('submit', function(event) {
								event.preventDefault();
							
								let currentActionUrl = $('#bookLessonForm').attr('action');
								let newActionLink = currentActionUrl + $('#modalStudentId').text();
								$('#bookLessonForm').attr('action', newActionLink);
							
								//if (!validateMeetLink(googleMeetLink)) {
								//	alert("Please provide a valid Google Meet link.");
								//	return;
							//	}
								
								const form = document.getElementById('bookLessonForm');
								const formData = new FormData(form);

								// Send the form data via fetch
								fetch(form.action, {
									method: 'POST',
									body: formData,
									headers: {
										'X-CSRFToken': '{{ csrf_token }}', // Include CSRF token for protection
									},
								})
									.then(response => {
										if (response.ok) {
											// Handle success (e.g., show a success message, refresh the page)
											$('#pickLessonModal').hide(); // Close the modal after successful booking
											location.reload(); // Reload to see changes, or handle it differently
											$('#notification').fadeIn(5000).delay(30000).fadeOut(5000); // Show for 2 seconds

										} else {
											// Handle error (e.g., show an error message)
											alert('Error booking lesson. Please try again.');
										}
									})
									.catch(error => {
										console.error('Error:', error);
									});	
							
							});
						</script>
					</section>







					<div class="container planning mt-5 mb-5">
						<h1 class="text-center mb-4 header-title">Monthly Planning - October 2024</h1>

						<!-- Row for Week 1 -->
						<div class="row week-row">
							<div class="col day-box">
								<div class="day-title">1</div>
							</div>
							<div class="col day-box">
								<div class="day-title">2</div>
							</div>
							<div class="col day-box active-day">
								<div class="day-title">3</div>
								<div class="lesson-info">
									<div class="lesson-title">Geometry Basics</div>
									<div><strong>Time:</strong> 10:00 AM - 11:00 AM</div>
									<div><strong>Tutor:</strong> Mr. John Doe</div>
								</div>
							</div>
							<div class="col day-box">
								<div class="day-title">4</div>
							</div>
							<div class="col day-box">
								<div class="day-title">5</div>
							</div>
							<div class="col day-box">
								<div class="day-title">6</div>
							</div>
							<div class="col day-box">
								<div class="day-title">7</div>
							</div>
						</div>

						<!-- Row for Week 2 -->
						<div class="row week-row">
							<div class="col day-box">
								<div class="day-title">8</div>
							</div>
							<div class="col day-box">
								<div class="day-title">9</div>
							</div>
							<div class="col day-box">
								<div class="day-title">10</div>
								<div class="lesson-info">
									<div class="lesson-title">Fractions and Decimals</div>
									<div><strong>Time:</strong> 1:00 PM - 2:00 PM</div>
									<div><strong>Tutor:</strong> Ms. Sarah Lee</div>
								</div>
							</div>
							<div class="col day-box">
								<div class="day-title">11</div>
							</div>
							<div class="col day-box">
								<div class="day-title">12</div>
							</div>
							<div class="col day-box">
								<div class="day-title">13</div>
							</div>
							<div class="col day-box">
								<div class="day-title">14</div>
							</div>
						</div>

						<!-- Row for Week 3 -->
						<div class="row week-row">
							<div class="col day-box">
								<div class="day-title">15</div>
							</div>
							<div class="col day-box active-day">
								<div class="day-title">16</div>
								<div class="lesson-info">
									<div class="lesson-title">Algebra Basics</div>
									<div><strong>Time:</strong> 11:00 AM - 12:00 PM</div>
									<div><strong>Tutor:</strong> Mr. Alex Brown</div>
								</div>
							</div>
							<div class="col day-box">
								<div class="day-title">17</div>
							</div>
							<div class="col day-box">
								<div class="day-title">18</div>
							</div>
							<div class="col day-box">
								<div class="day-title">19</div>
							</div>
							<div class="col day-box">
								<div class="day-title">20</div>
							</div>
							<div class="col day-box">
								<div class="day-title">21</div>
							</div>
						</div>

						<!-- Row for Week 4 -->
						<div class="row week-row">
							<div class="col day-box">
								<div class="day-title">22</div>
							</div>
							<div class="col day-box">
								<div class="day-title">23</div>
							</div>
							<div class="col day-box">
								<div class="day-title">24</div>
							</div>
							<div class="col day-box">
								<div class="day-title">25</div>
							</div>
							<div class="col day-box">
								<div class="day-title">26</div>
							</div>
							<div class="col day-box">
								<div class="day-title">27</div>
							</div>
							<div class="col day-box">
								<div class="day-title">28</div>
							</div>
						</div>

						<!-- Row for Week 5 -->
						<div class="row week-row">
							<div class="col day-box">
								<div class="day-title">29</div>
							</div>
							<div class="col day-box">
								<div class="day-title">30</div>
							</div>
							<div class="col day-box">
								<div class="day-title">31</div>
							</div>
							<!-- Optional: Empty placeholders for remaining days to complete the row -->
							<div class="col"></div>
							<div class="col"></div>
							<div class="col"></div>
							<div class="col"></div>
						</div>

					</div>




					<!-- Payment History Section -->
					<section class="container-fluid payments">
						<div class="row justify-content-center">
							<div class="col-12">
								<div class="card-container shadow-lg">
									<div class="card">
										<div class="card-header bg-primary text-light text-center">
											<h4 class="mb-0">Tutor Payment History</h4>
										</div>
										<div class="card-body">
											<ul class="list-group mb-3">
												<li class="list-group-item d-flex justify-content-between align-items-center">
													<span><i class="bi bi-calendar-check me-2 text-success"></i> Payment for 10 lessons (01 Jan 2024)</span>
													<span class="badge bg-success">$500</span>
												</li>
												<li class="list-group-item d-flex justify-content-between align-items-center">
													<span><i class="bi bi-calendar-check me-2 text-warning"></i> Payment for 8 lessons (15 Feb 2024)</span>
													<span class="badge bg-warning">$400</span>
												</li>
												<li class="list-group-item d-flex justify-content-between align-items-center">
													<span><i class="bi bi-calendar-check me-2 text-danger"></i> Payment for 12 lessons (10 Mar 2024)</span>
													<span class="badge bg-danger">$600</span>
												</li>
												<li class="list-group-item d-flex justify-content-between align-items-center">
													<span><i class="bi bi-calendar-check me-2 text-info"></i> Payment for 15 lessons (20 Mar 2024)</span>
													<span class="badge bg-info">$750</span>
												</li>
												<li class="list-group-item d-flex justify-content-between align-items-center">
													<span><i class="bi bi-calendar-check me-2 text-success"></i> Payment for 20 lessons (05 Apr 2024)</span>
													<span class="badge bg-success">$1,000</span>
												</li>
											</ul>
											<button class="btn btn-outline-dark w-100" id="loadMorePayments">
												<i class="bi bi-plus-circle me-2"></i> View More Payments
											</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</section>






				</main>
			</div>
		</div>

		<footer class="mb-0 text-center text-light p-2" id='footer' >
			<span class='text-center'>&copy; 2024 GLEENKAY All rights reserved.</span>
		</footer>

	</body>
</html>
